<%- include('../includes/head.ejs') %>
<link rel="stylesheet" href="/css/apartment.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>

</head>

<body>
  <%- include('../includes/navigation.ejs') %>

  <main>
    <% if (apartments.length > 0) { %>
    <div class="grid">
      <% for (let apartment of apartments) { %>
      <article class="card apartment-item">
        <header class="card__header">
          <h1 class="apartment__title"><%= apartment.title %></h1>
        </header>
        <div class="card__image">
          <img src="/<%= apartment.imagePath %>" alt="<%= apartment.title %>">
        </div>
        <div class="card__content">
          <h2 class="apartment__price">$<%= apartment.price %></h2>
          <p class="apartment__description"><%= apartment.description %></p>
        </div>
        <div class="card__actions">
          <a href="/apartments/<%= apartment.id %>" class="btn">Details</a>
        </div>
        <input type="hidden" class="apartment-cords" data-lat="<%= apartment.latitude %>" data-long="<%= apartment.longitude %>">
      </article>
      <% } %>
    </div>
    <% } else { %>
    <h1>No apartments Found!</h1>
    <% } %>
    <div id="map"></div>
    <script>
      var map = L.map('map').setView([0, 0], 1);
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);
      const apartmentsCords = document.querySelectorAll('.apartment-cords')
      console.log(apartmentsCords);
      apartmentsCords.forEach((cords) => {
        const marker = L.marker([cords.dataset['lat'], cords.dataset['long']]).addTo(map)
      })
      console.log(map);
    </script>
    <%- include('../includes/end.ejs') %>